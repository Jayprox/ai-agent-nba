ğŸ§  AI Agent NBA â€” Phase 7.5 Recovery & Continuation Prompt

You are resuming work on the AI Agent NBA Backend Project for user J.D.
The current development phase is Phase 7.5: AI Narrative Layer Integration (Backend) â€” checkpoint Step 2 verified (Async + Throttle upgrade) and ready for Step 3 (Frontend-ready Markdown & JSON endpoint).

---
ğŸ—ï¸ Project Summary (as of this checkpoint)
Project Goal:
Build a backend AI system that generates and serves dynamic, data-driven NBA narratives using real-time odds, player trends, and team performance data â€” powering a React/Next.js frontend for a sports analytics app.

Tech Stack:
- Backend: Python + FastAPI
- Frontend: React / Next.js (in progress)
- AI API: OpenAI GPT-4o
- Data Source: API-Basketball odds feed
- Tests: Pytest suite (located in /backend/tests/)

Core File Locations:
/backend
 â”œâ”€â”€ main.py
 â”œâ”€â”€ routes/
 â”‚    â””â”€â”€ narrative.py           â† currently being enhanced (v2-async verified)
 â”œâ”€â”€ services/
 â”‚    â””â”€â”€ openai_service.py      â† handles GPT-4o calls (validated)
 â”œâ”€â”€ common/
 â”‚    â””â”€â”€ odds_utils.py          â† verified odds fetch
 â”œâ”€â”€ agents/
 â”‚    â”œâ”€â”€ trends_agent/
 â”‚    â”œâ”€â”€ team_offense_agent/
 â”‚    â”œâ”€â”€ team_defense_agent/
 â”‚    â””â”€â”€ player_performance_agent/
 â”œâ”€â”€ tests/
 â”‚    â”œâ”€â”€ ai_narrative_test.py
 â”‚    â”œâ”€â”€ test_narrative_contract.py
 â”‚    â””â”€â”€ test_openai_connect.py
 â””â”€â”€ .env                        â† contains valid OPENAI_API_KEY + ODDS_API_KEY

---
âœ… Current Verified State
1. openai_service.py upgraded â€” GPT-4o JSON schema stable.
2. ai_narrative_test.py and test_openai_connect.py verified OpenAI key and GPT model retrieval.
3. /nba/narrative/today endpoint runs fully async, supports caching and throttling.
4. Both template and AI modes produce structured outputs.
5. Step 2 (Async + Throttle) complete; performance validated via cURL.

---
ğŸ¯ Next Planned Step (Step 3 â€” Frontend-ready Markdown Layer)
Add a new /nba/narrative/markdown endpoint returning both Markdown and JSON.
Normalize AI and template summaries into a unified structure.
Preserve existing cache/throttle behavior.
Maintain prompt_version = "v3-frontend" and embed inputs_digest for React cache invalidation.
Ensure Markdown output is properly escaped and ready for rendering in React.
Add optional query param ?compact=true for summarized Markdown.

---
âš™ï¸ Testing Targets
curl -s "http://127.0.0.1:8000/nba/narrative/markdown?mode=ai" | jq '.summary.metadata'
curl -s "http://127.0.0.1:8000/nba/narrative/markdown?mode=template" | jq '.markdown'

Expected:
- "prompt_version": "v3-frontend"
- "cache_used": false then true on repeat
- Markdown text output ready for rendering in React

---
ğŸ§© When Resuming, The AI Should:
Recognize last verified version was routes/narrative.py (v2-async).
Generate full replacement file for Step 3 with Markdown + JSON hybrid response.
Provide post-update test instructions (2 cURLs + 1 pytest).
Verify that existing async + cache logic remains intact.
Prepare for Step 4: frontend integration and environment-specific configs (staging keys).

Reference Checkpoint Name:
ğŸ Checkpoint: â€œPhase 7.5 â†’ Step 2 Verified â€” Async + Throttle Stable (2025-11-15)â€

---
âœ… To Resume
Paste this prompt into ChatGPT and say:
â€œResume from Checkpoint: Phase 7.5 â†’ Step 2 Verified â€” Async + Throttle Stable (2025-11-15). Continue with Step 3 (Frontend-ready Markdown endpoint).â€


--------------------------------------------------------------------------------

ğŸ§  Emergency Resume Prompt â€” AI Agent NBA Project (Phase 7.5)

Resume work on the AI Agent NBA backend for J.D.
Current checkpoint: Phase 7.5 â†’ Step 2 Verified â€” Async + Throttle Stable (2025-11-15).

âœ… FastAPI backend verified; async /nba/narrative/today endpoint with cache + throttle.
âœ… openai_service.py and odds_utils.py validated; GPT-4o JSON schema correct.
âœ… Prompt version: "v2-async" confirmed.

Next step (Step 3):
Add /nba/narrative/markdown endpoint returning both JSON + Markdown.
Normalize AI and template outputs for React display.
Include ?compact=true for condensed Markdown.
Preserve async/cache/throttle behavior.
Set prompt_version="v3-frontend".

When resuming, start by generating the full upgraded routes/narrative.py file for Step 3,
then test with cURL and verify metadata + markdown output.
